<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home Video</title>
    <script src="/public/Video.js5.16/js/video.min.js"></script>
    <script src="/public/Jquery1.12/jquery.min.js"></script>
    <script src="/public/jquery.cookie1.4.1.min.js"></script>
    <link rel="stylesheet" href="/public/Video.js5.16/css/video-js.min.css">
</head>

<body>
    <video id="myVideo" class="video-js vjs-default-skin" controls autoplay
        poster="http://16to.com/static/img/logo.png">
    </video>
</body>
<script>
    function getUrlParam(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
        var r = window.location.search.substr(1).match(reg);  //匹配目标参数
        if (r != null) return r[2]; return null; //返回参数值
    }

    let i = 0;
    let list = [];
    jQuery.get("/api/list", function (res, err) {
        const arr = JSON.parse(res);
        const curSrc = getUrlParam("src");
        arr.forEach((item, index) => {
            if (encodeURI(item.src) === curSrc) {
                i = index;
                return;
            }
        });
        list = arr;
        init();
    });
    function init() {
        var player = videojs('myVideo', {
            autoplay: true,
            controls: true,
            preload: "auto",
            isFullscreen: true,
            language: "zh",
            "sources": [{
                src: list[i].src,
                type: "video/mp4"
            }],
        },
            function onPlayerReady() {
                // this.play();
                // this.requestFullscreen();
                console.log(i);
                jQuery.cookie('videoSrc', list[i].src, { expires: 365 });
                this.on('ended', function () {
                    i++;
                    if (i >= list.length) {
                        i = 0;
                    }
                    var videoObj = list[i];
                    this.src({ type: "video/mp4", src: videoObj.src });
                    jQuery.cookie('videoSrc', videoObj.src, { expires: 365 });
                    this.play();
                });
            });
    }
</script>

</html>